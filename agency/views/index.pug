extends layout

block content
  h1 Agent Management
  
  h2 Agents
  table
    thead
      tr
        th Agent Code
        th Agent Name
        th Contract Level
        th Actions
    tbody
      each agent in agents
        tr
          td= agent.agent_code
          td= agent.agent_name
          td= agent.contract_level
          td
            button(onclick=`editAgent(${agent.agent_code}, '${agent.agent_name}', '${agent.contract_level}')`) Edit
            button(onclick=`deleteAgent(${agent.agent_code})`) Delete
  
  h2 Add Agent
  form(action="/agents" method="POST")
    label(for="agent_name") Agent Name:
    input(type="text" id="agent_name" name="agent_name" required)
    
    label(for="contract_level") Contract Level:
    input(type="text" id="contract_level" name="contract_level" required)
    
    input(type="submit" value="Add Agent")

  h2 Update Agent
  form(action="/agents" method="PUT" id="updateForm")
    input(type="hidden" id="updateAgentCode" name="agent_code")
    
    label(for="updateAgentName") Agent Name:
    input(type="text" id="updateAgentName" name="agent_name" required)
    
    label(for="updateContractLevel") Contract Level:
    input(type="text" id="updateContractLevel" name="contract_level" required)
    
    input(type="submit" value="Update Agent")

  script.
    function editAgent(agentCode, agentName, contractLevel) {
      document.getElementById('updateAgentCode').value = agentCode;
      document.getElementById('updateAgentName').value = agentName;
      document.getElementById('updateContractLevel').value = contractLevel;
      document.getElementById('updateForm').scrollIntoView();
    }

    function deleteAgent(agentCode) {
      const confirmation = confirm('Are you sure you want to delete this agent?');
      if (confirmation) {
        fetch(`/agents/${agentCode}`, {
          method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            location.reload(); 
          } else {
            alert('Error deleting agent.');
          }
        });
      }
    }
